<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Topology | JP Salomon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <meta name="description"
        content="Research topology by JP Salomon. Interactive network of papers on AI alignment, cognitive science, and complexity.">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body {
            overflow: hidden;
            /* Canvas handles scroll */
            background-color: #fcfcfc;
            /* Subtle grid background */
            background-image:
                linear-gradient(#e5e7eb 1px, transparent 1px),
                linear-gradient(90deg, #e5e7eb 1px, transparent 1px);
            background-size: 40px 40px;
        }

        #constellation-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        /* Reader Modal */
        #reader-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            pointer-events: none;
            transform: scale(0.98);
        }

        #reader-modal.open {
            opacity: 1;
            pointer-events: all;
            transform: scale(1);
        }

        /* HUD Elements */
        .hud-panel {
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="antialiased min-h-screen text-gray-900">

    <!-- Canvas -->
    <canvas id="constellation-canvas"></canvas>

    <!-- Navigation Overlay -->
    <nav class="fixed top-0 w-full z-40 pointer-events-none">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center pointer-events-auto">
            <a href="index.html"
                class="hud-panel px-4 py-2 rounded-full text-sm font-medium hover:bg-white text-gray-600 flex items-center gap-2 group transition-all">
                <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
                <span>Home</span>
            </a>

            <div class="hud-panel px-6 py-2 rounded-full hidden md:block">
                <span class="serif text-lg tracking-tight">JP SALOMON</span>
                <span class="text-xs uppercase tracking-widest text-gray-400 ml-2">Cognitive Topology</span>
            </div>

            <div class="flex gap-2">
                <button onclick="resetCamera()" class="hud-panel p-2 rounded-full hover:bg-white text-gray-500"
                    title="Reset View">
                    <i data-lucide="scan" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Instructions Toast -->
    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-30 pointer-events-none animate-bounce">
        <div class="hud-panel px-4 py-2 rounded-full text-xs uppercase tracking-widest text-gray-400">
            Drag to Explore â€¢ Scroll to Zoom
        </div>
    </div>

    <!-- PDF Reader Modal -->
    <div id="reader-modal"
        class="fixed inset-0 z-50 flex items-center justify-center p-2 md:p-6 bg-white/60 backdrop-blur-sm">
        <div
            class="w-full h-full max-w-6xl bg-white shadow-2xl rounded-xl border border-gray-200 flex flex-col overflow-hidden relative">

            <!-- Toolbar -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-[#fcfcfc]">
                <h3 id="reader-title" class="font-serif text-lg truncate pr-4">Paper Title</h3>
                <div class="flex items-center gap-4">
                    <a id="reader-download" href="#" target="_blank"
                        class="text-xs uppercase tracking-wider text-gray-500 hover:text-black flex items-center gap-2 transition-colors">
                        <i data-lucide="download" class="w-4 h-4"></i> Download PDF
                    </a>
                    <button onclick="closeReader()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-grow relative bg-gray-50">
                <iframe id="reader-frame" class="w-full h-full" src="about:blank"></iframe>
            </div>
        </div>
    </div>

    <script src="js/manifest.js"></script>
    <script src="js/constellation.js"></script>
    <script>
        let graph;

        document.addEventListener('DOMContentLoaded', () => {
            const papersData = window.siteManifest?.papers || [];
            graph = new ConstellationGraph('constellation-canvas', papersData);

            if (window.lucide) lucide.createIcons();

            // Hide instructions after interaction
            document.addEventListener('mousedown', () => {
                const toast = document.querySelector('.animate-bounce');
                if (toast) toast.style.opacity = '0';
            }, { once: true });
        });

        // Global Reader Functions (called by graph engine)
        window.openReader = function (url, title) {
            const modal = document.getElementById('reader-modal');
            const frame = document.getElementById('reader-frame');
            const titleEl = document.getElementById('reader-title');
            const downloadLink = document.getElementById('reader-download');

            titleEl.textContent = title;
            downloadLink.href = url;
            frame.src = url;

            modal.classList.add('open');
        };

        window.closeReader = function () {
            const modal = document.getElementById('reader-modal');
            const frame = document.getElementById('reader-frame');

            modal.classList.remove('open');
            setTimeout(() => { frame.src = 'about:blank'; }, 300);
        };

        window.resetCamera = function () {
            if (graph) {
                graph.pan.x = graph.canvas.width / 2;
                graph.pan.y = graph.canvas.height / 2;
                graph.scale = 1;
            }
        };

        // Esc to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeReader();
        });
    </script>
</body>

</html>